# Media Maestro - Media Organizer

This is a local-first media organizer application that helps you organize your photos and videos into a structured directory format.

## Quick Start

### Requirements
- Node.js 20+ and npm
- macOS, Linux, or Windows
- A Chromium-based browser (File System Access API support) for the web app

### Web App
```bash
npm install
npm run dev
```
Open http://localhost:9003 and follow the 4-step wizard (Select Folders → Options → Dry-Run → Execute).

### CLI
```bash
cd media-organizer-cli
npm install
npm run build
node dist/execute-plan.js --plan ./media-organizer-plan.json --source-root "<source dir>" --dest-root "<dest dir>" --dry-run
```
Add `--execute --verify` when you are ready to copy files. See the CLI README for more examples.

### Workflow at a Glance
1. Pick source/destination folders (browser prompts for permissions).
2. Configure layout, duplicate detection, and run the planner (progress toasts show scanning status).
3. Review the Dry-Run table (export JSON/CSV, retry problematic files).
4. Execute in-browser or download the plan and run it via the CLI.

*(Screenshot or diagram placeholder — add when available.)*

## Key Features

- **Local First & Safe**: All file operations happen directly in your browser. Your files are never uploaded to a server. The application follows a strict **copy-only** policy, meaning your original files are never moved or deleted.
- **In-Browser Execution**: Run the entire organization process in your browser with features like pause, resume, and cancellation. The application automatically saves your progress and allows you to resume an incomplete session even after reloading the page.
- **Customizable Organization**: Define your own directory structure using placeholders like `{YYYY}` for year and `{MM}` for month.
- **Dry-Run Mode**: Preview the file operations before executing them to ensure everything is correct.

## Safety

This application is designed with safety in mind. **It never deletes your source files.** All operations are copy-only. After you have verified that your files have been organized correctly in the destination folder, you can manually delete the source files.

## CLI Usage

For users who prefer to run the organization process outside the browser, a companion Command-Line Interface (CLI) is available in the `media-organizer-cli` directory. It is designed to execute plans generated by the web UI with high performance and additional features like file verification and concurrent operations.

> **Important:** The CLI now requires both `--source-root` and `--dest-root` so it can resolve relative paths from the plan. These flags must point to the actual source and destination directories on your filesystem.

For detailed instructions on installation and usage, please refer to the [CLI's README file](./media-organizer-cli/README.md).

## Architecture and Development

This application is built with Next.js (App Router) and uses Zustand for global state management. All hashing (SHA-256/pHash) and metadata extraction tasks are delegated to a pool of Web Workers so the UI stays responsive, even when scanning tens of thousands of files.

For a detailed analysis of the project's structure, key components, and a summary of recent refactoring efforts, please see the [Architecture Review](./docs/architecture-review.md) document.

## Testing

This project uses a Jest-like environment for unit tests. Test files (`*.spec.ts`) are located alongside the features they test (e.g., in `__tests__` subdirectories) or in the top-level `/tests` directory.

For an example of how business logic is tested, see the test suite for the core planning logic at `src/features/plan/__tests__/plan-builder.spec.ts`.

Note: The `package.json` file does not contain a `test` script, so running the tests may require a specific local setup or direct invocation of a test runner like Jest or Vitest.

## Troubleshooting

| Symptom | Likely Cause / Fix |
| --- | --- |
| Browser can’t see folders | Ensure you’re using Chrome/Edge and grant File System Access permissions when prompted. |
| Plan generation is stuck | Keep the tab focused; worker pools run client-side, so large libraries can take time. Check DevTools console for worker errors. |
| CLI exits with “source path outside of root” | Pass absolute `--source-root` and `--dest-root` that point to the real directories used when generating the plan. |
| MediaInfo errors | Make sure `npm install` copied `MediaInfoModule.wasm` into `public/mediainfo`. Re-run `npm install` if necessary. |

## MediaInfo WASM Handling
MediaInfo WASM is served from `/public/mediainfo`. It is copied on `postinstall` and initialized in the browser with `locateFile()`.

---

Built by [Bassam Alsaqqa](https://github.com/Bassamalsaqqa)
- [LinkedIn](https://www.linkedin.com/in/bassamalsaqqa/)
